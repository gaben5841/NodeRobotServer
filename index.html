<html>
    <head>
        <title>robot control</title>
        <script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        
        </script>
    </head>
    <body>
        <h1>Webrobot</h1>
        <h3>Video Stream</h3>
        <img id='videoStream'>
        <h3 id="clients">Clients Connected:</h3>
        <script type='text/javascript'>
            const ws = new WebSocket('ws://192.168.7.85:3000');
            ws.onopen = () => { 
                console.log('Now connected'); 
            };
            const imageElm = document.getElementById('videoStream');
            const clients = document.getElementById('clients');
            ws.onmessage = async function(event) {
                console.log(event.data);
                if (event.data instanceof Blob === true) {
                    const blob = event.data;
                    const objectURL = URL.createObjectURL(blob);

                    imageElm.onload = () => {
                        URL.revokeObjectURL(objectURL);
                        imageElm.onload = null;
                    };
                    imageElm.src = objectURL;
                } else {
                    clients.innerHTML = " ";
                    clients.innerHTML = "Clients Connected: " + event.data;
                }
            };
            $(document).ready(function() { 
                console.log("ready");
                $(document).on('keypress', function (e) {
                    console.log(e.key);
                    ws.send(e.key)
                });
            });
        </script>
    </body>
</html>